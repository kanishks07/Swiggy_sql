-- Display all customers who live in 'Delhi'.
SELECT name, city FROM customers
WHERE city = "Delhi";

-- Find the average rating of all restaurants in 'Mumbai'.
SELECT city, avg(rating) FROM restaurants
WHERE city = "Mumbai"
GROUP BY city;


-- List all customers who have placed at least one order.
SELECT customers.name, count(customers.customer_id) order_count
FROM customers JOIN orders
ON customers.customer_id = orders.customer_id
GROUP BY customers.customer_id
HAVING count(orders.order_id >= 1);



-- Display the total number of orders placed by each customer.
SELECT customers.name, count(orders.customer_id) Total_orders
FROM customers JOIN orders
ON customers.customer_id = orders.customer_id
GROUP BY customers.customer_id;


-- Find the total revenue generated by each restaurant.
SELECT sum(TOTAL_AMOUNT) total_revenue, restaurants.name
FROM restaurants JOIN orders
ON restaurants.restaurant_id = orders.restaurant_id
GROUP BY restaurants.name;


-- Find the top 5 restaurants with the highest average rating.
SELECT name, avg(rating) FROM restaurants
GROUP BY name
ORDER BY avg(rating) desc
LIMIT 5;


-- Display all customers who have never placed an order.
SELECT distinct customers.name, orders.order_id
FROM customers LEFT JOIN orders
ON customers.customer_id = orders.customer_id
WHERE orders.order_id is null;


-- Find the number of orders placed by each customer in 'Mumbai'.
SELECT customers.name, count(orders.customer_id) Total_orders, customers.city 
FROM customers JOIN orders
ON customers.customer_id = orders.customer_id
WHERE city = "Mumbai"
GROUP BY customers.customer_id;


-- Display all orders placed in the last 30 days. 
SELECT * FROM orders
WHERE order_date >= (SELECT max(order_date) FROM orders) - interval 30 day;


-- List all delivery partners who have completed more than 1 delivery
SELECT deliverypartners.name, deliverypartners.partner_id, COUNT(orderdelivery.order_id) Total_deliveries
FROM deliverypartners JOIN orderdelivery 
ON deliverypartners.partner_id = orderdelivery.partner_id
JOIN deliveryupdates 
ON orderdelivery.order_id = deliveryupdates.order_id
WHERE deliveryupdates.status = 'Delivered'
GROUP BY deliverypartners.partner_id , deliverypartners.name
HAVING count(orderdelivery.order_id) > 1;


-- Find the customers who have placed orders on exactly three different days.
SELECT customers.name, customers.customer_id
FROM customers JOIN orders
ON customers.customer_id = orders.customer_id
GROUP BY customers.name, customers.customer_id
HAVING count(distinct date (orders.order_date)) = 3;


-- Find the delivery partner who has worked with the most different customers.
SELECT deliverypartners.name, deliverypartners.partner_id,
 COUNT(DISTINCT orders.customer_id) AS total_customers
FROM deliverypartners
JOIN orderdelivery
ON deliverypartners.partner_id = orderdelivery.partner_id
JOIN orders
ON orderdelivery.order_id = orders.order_id
GROUP BY deliverypartners.name, deliverypartners.partner_id
ORDER BY total_customers desc
LIMIT 1;
